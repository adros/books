<div *ngIf="isLoading" class="d-flex justify-content-center">
  <div class="spinner-border" role="status">
    <span class="sr-only">Loading...</span>
  </div>
</div>

<form #form="ngForm" [hidden]="isLoading" class="mt-2 mb-2">
  <div class="form-row">
    <div class="col-lg-2 col-md-3 col-sm-6">
      <select class="form-control form-control-sm" id="sortSelect" [(ngModel)]="sort" name="sort">
        <option value="order_asc"># &uarr;</option>
        <option value="order_desc"># &darr;</option>
        <option value="title_asc">Názov &uarr;</option>
        <option value="title_desc">Názov &darr;</option>
        <option value="original_asc">Pôvodný názov &uarr;</option>
        <option value="original_desc">Pôvodný názov &darr;</option>
        <option value="published_asc">Rok vydania &uarr;</option>
        <option value="published_desc">Rok vydania &darr;</option>
        <option value="pages_asc">Počet strán &uarr;</option>
        <option value="pages_desc">Počet strán &darr;</option>
        <option value="author_asc">Autor &uarr;</option>
        <option value="author_desc">Autor &darr;</option>
        <option value="serie_asc">Séria &uarr;</option>
        <option value="serie_desc">Séria &darr;</option>
        <option value="firstReading_asc">Prečítané 1.x &uarr;</option>
        <option value="firstReading_desc">Prečítané 1.x &darr;</option>
        <option value="lastReading_asc">Prečítané N.x &uarr;</option>
        <option value="lastReading_desc">Prečítané N.x &darr;</option>
        <option value="pictureName_asc">Obrázok &uarr;</option>
        <option value="pictureName_desc">Obrázok &darr;</option>
      </select>
    </div>

    <div class="col-lg-2 col-md-3 col-sm-6">
      <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-outline-primary btn-sm" [ngClass]="{active:layout=='table'}">
          <input type="radio" name="layout" value="table" [(ngModel)]="layout"> Tabuľka
        </label>
        <label class="btn btn-outline-primary btn-sm" [ngClass]="{active:layout=='cards'}">
          <input type="radio" name="layout" value="cards" [(ngModel)]="layout"> Karty
        </label>
        <label class="btn btn-outline-primary btn-sm" [ngClass]="{active:layout=='pictures'}">
          <input type="radio" name="layout" value="pictures" [(ngModel)]="layout"> Obrázky
        </label>
      </div>
    </div>
  </div>
</form>

<div *ngIf="!isLoading">
  <table *ngIf="layout === 'table'" class="table table-hover table-sm table-responsive">
    <thead class="thead-light">
      <tr>
        <th (click)="hSortClick('order')" [class]="thClass('order')">#</th>
        <th (click)="hSortClick('title')" [class]="thClass('title')">Názov</th>
        <th (click)="hSortClick('original')" [class]="thClass('original')">Pôvodný názov</th>
        <th (click)="hSortClick('published')" [class]="thClass('published')">Rok&nbsp;vydania</th>
        <th (click)="hSortClick('pages')" [class]="thClass('pages')">Počet&nbsp;strán</th>
        <th (click)="hSortClick('author')" [class]="thClass('author')">Autor</th>
        <th (click)="hSortClick('serie')" [class]="thClass('serie')">Séria</th>
        <th (click)="hSortClick('reading')" [class]="thClass('reading')">Prečítané</th>
        <th (click)="hSortClick('pictureName')" [class]="thClass('pictureName')">Obrázok</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let book of displayedData | async">
        <td>{{book.order}}</td>
        <td><a [routerLink]="['/books', book.id]">{{book.title}}</a></td>
        <td>{{book.original}}</td>
        <td>
          <ng-container *ngIf="book.published">{{book.published}}</ng-container>
        </td>
        <td>{{book.pages}}</td>
        <td><span *ngFor="let author of book.authors" class="column-item">{{author.lastName}},
            {{author.firstName}}</span>
        </td>
        <td><span *ngFor="let serie of book.series" class="column-item">{{serie.title}}</span></td>
        <td><span *ngFor="let reading of book.readings" class="column-item"
            title="Poradie: {{reading.totalOrder}}">{{reading.year}}</span></td>
        <td>
          <input type="checkbox" [checked]="!!book.pictureName" disabled>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="layout == 'cards'">
    <div class="b-cards">
      <div class="card border mb-3" *ngFor="let book of displayedData | async">
        <div class="card-header text-center" [title]="book.title">
          <a [routerLink]="['/books', book.id]">{{book.title}}</a>
        </div>
        <div class="card-body">
          <div class="text-center"><img src="{{booksService.getImgUrl(book.id)}}"></div>
          May, Karl
          Original: Der Flucher
          Published: 1952
          Genre: Dobrodružný Román
          Pages: 124 • Read: 1998, 2016
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="layout == 'pictures'" class="pictures">
    <a *ngFor="let book of displayedData | async" [routerLink]="['/books', book.id]">
      <img src="{{booksService.getImgUrl(book.id)}}">
    </a>
  </div>

  <!--
<ngx-table #table [configuration]="configuration" [data]="data | async" [columns]="columns"
  (event)="eventEmitted($event)">
  <ng-template let-row>
    <td><a [routerLink]="['/books', row.id]">{{row.title}}</a></td>
    <td>{{row.original}}</td>
    <td>
      <ng-container *ngIf=" row.published">{{row.published}}</ng-container>
    </td>
    <td>{{row.pages}}</td>
    <td><span *ngFor="let author of row.authors" class="column-item">{{author.lastName}}, {{author.firstName}}</span>
    </td>
    <td><span *ngFor="let serie of row.series" class="column-item">{{serie.title}}</span></td>
    <td><span *ngFor="let reading of row.readings" class="column-item"
        title="Poradie: {{reading.totalOrder}}">{{reading.year}}</span></td>
    <td>
      <input type="checkbox" [checked]="!!row.pictureName" disabled>
    </td>
  </ng-template>
</ngx-table>-->
